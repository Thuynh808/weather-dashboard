---
- name: weather-dashboard setup
  hosts: localhost
  vars_files: .aws-keys.yaml
  tasks:
  - name: install system packages
    yum:
      name: "{{ item }}"
      state: present
    loop:
      - python3
      - python3-pip
      - curl
      - unzip
  - name: install python dependencies
    pip:
      name: "{{ item }}"
      state: present
    loop:
      - boto3==1.26.137
      - python-dotenv==1.0.0
      - requests==2.28.2
  - name: download and unzip aws-cli
    unarchive:
      src: "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip"
      dest: ../
      remote_src: yes
  - name: install aws-cli and configure credentials
    shell: "{{ item }}"
    loop:
      - 'sudo ../aws/install'
      - 'aws configure set aws_access_key_id {{ accesskey-id }}'
      - 'aws configure set aws_secret_access_key {{ secretaccess-key }}'
      - 'aws configure set default.region {{ default-region }}'
