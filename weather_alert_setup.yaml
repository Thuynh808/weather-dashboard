- name: setup sns notifications
  hosts: localhost
  gather_facts: false
  vars_files: myvars.yaml
  tasks:
  - name: create alarm sns topic and subscribe email
    community.aws.sns_topic:
      name: "weather-alerts"
      state: present
      display_name: "weather-alerts"
      subscriptions:
        - endpoint: "{{ emailendpoint }}"
          protocol: "email"
    register: sns_topic
  - name: append sns_arn to myvars.yaml
    lineinfile:
      path: ./myvars.yaml
      line: "sns_arn: \"{{ sns_topic['sns_arn'] }}\""
      insertafter: EOF
  tags: notifications
